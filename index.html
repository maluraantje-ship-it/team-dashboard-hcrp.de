<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Abmeldung & Team-Log System</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #2c2f33;
      color: #fff;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      background: #36393f;
      padding: 30px;
      border-radius: 12px;
      width: 100%;
      max-width: 600px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.5);
    }
    h1 { text-align: center; color: #7289da; }
    label { display: block; margin: 15px 0 5px; font-weight: bold; }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #202225;
      border-radius: 6px;
      background: #2f3136;
      color: white;
      box-sizing: border-box;
    }
    .field { display: none; } /* Dynamische Felder verstecken */
    .buttons {
      display: flex;
      gap: 15px;
      margin-top: 30px;
      justify-content: center;
    }
    button {
      padding: 14px 28px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #5865f2;
      color: white;
    }
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(88,101,242,0.4);
      background: #4752c4;
    }
    button:active {
      transform: translateY(1px);
    }
    #status {
      text-align: center;
      margin-top: 20px;
      font-weight: bold;
    }
    .success { color: #43b581; }
    .error   { color: #f04747; }
  </style>
</head>
<body>

<div class="container">
  <h1>Abmeldung & Team-Log System</h1>

  <form id="logForm">
    <label for="aktion">Aktion auswählen:</label>
    <select id="aktion" required>
      <option value="">-- Wähle eine Aktion --</option>
      <option value="abmeldung">Abmeldung</option>
      <option value="teamwarn">Teamwarn</option>
      <option value="teamkick">Teamkick</option>
      <option value="einstellung">Einstellung</option>
      <option value="uprank">Uprank</option>
      <option value="downrank">Downrank</option>
    </select>

    <!-- Gemeinsame Felder -->
    <div id="grundField" class="field">
      <label for="grund">Grund:</label>
      <textarea id="grund" rows="4"></textarea>
    </div>

    <div id="datumField" class="field">
      <label for="datum">Datum:</label>
      <input type="date" id="datum">
    </div>

    <div id="werField" class="field">
      <label for="wer">Wer (User / Nick):</label>
      <input type="text" id="wer">
    </div>

    <div id="vonField" class="field">
      <label for="von">Von (Moderator):</label>
      <input type="text" id="von">
    </div>

    <!-- Spezifische Felder -->
    <div id="abField" class="field">
      <label for="ab">Ab wann:</label>
      <input type="date" id="ab">
    </div>

    <div id="bisField" class="field">
      <label for="bis">Bis wann:</label>
      <input type="date" id="bis">
    </div>

    <div id="abgesprochenField" class="field">
      <label for="abgesprochen">Abgesprochen mit:</label>
      <input type="text" id="abgesprochen">
    </div>

    <div id="neueRolleField" class="field">
      <label for="neueRolle">Neue Rolle:</label>
      <input type="text" id="neueRolle">
    </div>

    <div id="alteRolleField" class="field">
      <label for="alteRolle">Alte Rolle:</label>
      <input type="text" id="alteRolle">
    </div>

    <div class="buttons">
      <button type="submit">Absenden</button>
      <button type="reset">Zurücksetzen</button>
    </div>
  </form>

  <div id="status"></div>
</div>

<script>
  const form = document.getElementById('logForm');
  const statusDiv = document.getElementById('status');
  const aktionSelect = document.getElementById('aktion');

  // Felder per ID
  const fields = {
    grund: document.getElementById('grundField'),
    datum: document.getElementById('datumField'),
    wer: document.getElementById('werField'),
    von: document.getElementById('vonField'),
    ab: document.getElementById('abField'),
    bis: document.getElementById('bisField'),
    abgesprochen: document.getElementById('abgesprochenField'),
    neueRolle: document.getElementById('neueRolleField'),
    alteRolle: document.getElementById('alteRolleField')
  };

  // Zeige Felder basierend auf Aktion
  aktionSelect.addEventListener('change', (e) => {
    const aktion = e.target.value;

    // Alle Felder verstecken und required entfernen
    Object.values(fields).forEach(field => {
      field.style.display = 'none';
      field.querySelector('input, textarea').required = false;
    });

    if (!aktion) return;

    // Gemeinsame Felder für alle (außer Abmeldung hat Name statt Wer)
    fields.grund.style.display = 'block';
    fields.grund.querySelector('textarea').required = true;
    fields.datum.style.display = 'block';
    fields.datum.querySelector('input').required = true;
    fields.von.style.display = 'block';
    fields.von.querySelector('input').required = true;

    switch (aktion) {
      case 'abmeldung':
        fields.wer.style.display = 'block'; // Als "Name"
        fields.wer.querySelector('label').textContent = 'Dein Name / Nick:';
        fields.wer.querySelector('input').required = true;
        fields.ab.style.display = 'block';
        fields.ab.querySelector('input').required = true;
        fields.bis.style.display = 'block';
        fields.bis.querySelector('input').required = true;
        break;
      case 'teamwarn':
      case 'einstellung':
        fields.wer.style.display = 'block';
        fields.wer.querySelector('label').textContent = 'Wer:';
        fields.wer.querySelector('input').required = true;
        break;
      case 'teamkick':
        fields.wer.style.display = 'block';
        fields.wer.querySelector('label').textContent = 'Wer:';
        fields.wer.querySelector('input').required = true;
        fields.abgesprochen.style.display = 'block';
        fields.abgesprochen.querySelector('input').required = true;
        break;
      case 'uprank':
      case 'downrank':
        fields.wer.style.display = 'block';
        fields.wer.querySelector('label').textContent = 'Wer:';
        fields.wer.querySelector('input').required = true;
        fields.neueRolle.style.display = 'block';
        fields.neueRolle.querySelector('input').required = true;
        fields.alteRolle.style.display = 'block';
        fields.alteRolle.querySelector('input').required = true;
        break;
    }
  });

  // Submit-Handler
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const aktion = aktionSelect.value;
    if (!aktion) {
      statusDiv.textContent = '❌ Bitte eine Aktion auswählen!';
      statusDiv.className = 'error';
      return;
    }

    // Werte holen (trimmen wo nötig)
    const grund = fields.grund.querySelector('textarea').value.trim() || '–';
    const datum = fields.datum.querySelector('input').value || new Date().toISOString().split('T')[0];
    const von = fields.von.querySelector('input').value.trim() || '–';
    const wer = fields.wer.querySelector('input')?.value.trim() || '–';
    const ab = fields.ab.querySelector('input')?.value || '–';
    const bis = fields.bis.querySelector('input')?.value || '–';
    const abgesprochen = fields.abgesprochen.querySelector('input')?.value.trim() || '–';
    const neueRolle = fields.neueRolle.querySelector('input')?.value.trim() || '–';
    const alteRolle = fields.alteRolle.querySelector('input')?.value.trim() || '–';

    // Embed aufbauen
    let title = aktion.charAt(0).toUpperCase() + aktion.slice(1);
    let fieldsArray = [
      { name: 'Grund', value: grund, inline: false },
      { name: 'Datum', value: datum, inline: true },
      { name: 'Von', value: von, inline: true }
    ];

    if (aktion !== 'abmeldung') {
      fieldsArray.push({ name: 'Wer', value: wer, inline: true });
    } else {
      fieldsArray.push({ name: 'Name', value: wer, inline: true });
      fieldsArray.push({ name: 'Ab wann', value: ab, inline: true });
      fieldsArray.push({ name: 'Bis wann', value: bis, inline: true });
    }

    if (aktion === 'teamkick') {
      fieldsArray.push({ name: 'Abgesprochen mit', value: abgesprochen, inline: false });
    }

    if (aktion === 'uprank' || aktion === 'downrank') {
      fieldsArray.push({ name: 'Neue Rolle', value: neueRolle, inline: true });
      fieldsArray.push({ name: 'Alte Rolle', value: alteRolle, inline: true });
    }

    const message = {
      embeds: [{
        title: `Neue ${title}`,
        color: 0x5865f2,
        fields: fieldsArray,
        footer: { text: `Gesendet am ${new Date().toLocaleString('de-DE')}` },
        timestamp: new Date().toISOString()
      }]
    };

    // Webhooks definieren
    const abmeldungWebhook = 'https://discord.com/api/webhooks/DEINE_ABMELDUNG_WEBHOOK_URL_HIER'; // Ersetze mit dem für Abmeldung-Channel (1467907265486000251)
    const logWebhook = 'https://discord.com/api/webhooks/1472317894162383032/SpCZxD5Y2c7fn8BzEymHkJUlyu-bsGkZAdF91OjzBP5ZryrPdnEqYyftXOF5ddkaI9aJ'; // Dein gegebener für Log-Channel (1466082649775935518)

    statusDiv.textContent = '⏳ Wird gesendet...';
    statusDiv.className = '';

    try {
      // An Abmeldung-Channel senden (wenn Aktion Abmeldung)
      if (aktion === 'abmeldung') {
        await fetch(abmeldungWebhook, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(message)
        });
      }

      // Immer an Log-Channel senden
      const logResponse = await fetch(logWebhook, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(message)
      });

      if (logResponse.ok) {
        statusDiv.textContent = '✅ Erfolgreich gesendet!';
        statusDiv.className = 'success';
        form.reset();
        aktionSelect.dispatchEvent(new Event('change')); // Felder resetten
      } else {
        const errorText = await logResponse.text();
        throw new Error(`Discord Fehler: ${logResponse.status} - ${errorText}`);
      }
    } catch (err) {
      console.error(err);
      statusDiv.textContent = '❌ ' + err.message;
      statusDiv.className = 'error';
    }
  });
</script>

</body>
</html>
</body>
</html>
